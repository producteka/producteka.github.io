angular.module("app").factory("searchBarService",["configurationService","closedSignService",function(e,n){var t=e.searchBarService,r={},o=function(e,n){if(n)var t=r.suggestionsRelated;else var t=r.productsRelated;var o=e.split(" "),c="";return _.each(o,function(e){_.each(t,function(n){var t=!1;_.each(n,function(r){e===r&&(t=!0,_.each(n,function(e){c+=" "+e}))})})}),c},c=function(e){var n=function(e){return"s"===e.slice(-1)&&(e=e.slice(0,-1)),e};e=i(e);var r=e.split(" "),o=t.articles,c=[];return _.each(r,function(e){_.indexOf(o,e)<0&&(e=n(e),c.push(e))}),c},i=function(e){var n=e.toLowerCase(),n=_.deburr(n);return n},a=function(e,n){var t;return e===n&&(t=!0),t},u=function(e,n,t){var r=!0,c=i(e.producto);return void 0!=o(c,t)&&(c+=" "+o(c,t)),_.each(n,function(e){var n=new RegExp("\\b"+e,"i");-1==c.search(n)&&(r=!1)}),r},s=function(e,n,t){var r=_.find(t.allClients,["id",n.cliente[0].id]),o=[];return _.each(t.allHours,function(n){n.cliente[0]&&n.cliente[0].cliente===e&&o.push(n)}),{client:r,matchedProducts:[],hours:o}},l=function(e){var n=_.groupBy(e,function(e){return!0===e.openData.isOpen?"open":void 0!=e.openData.openTime?"openLater":"closed"});return n.open=_.shuffle(n.open),n.openLater=_.sortBy(n.openLater,[function(e){return e.openData.openTime}]),n},f={};return f.noResults=function(e){var n=void 0!=e.open&&e.open.length>0,t=void 0!=e.openLater&&e.openLater.length>0,r=void 0!=e.closed&&e.closed.length>0;return!(n||t||r)},f.getMatches=function(e,t,o){r=e;var i=c(t),f=[],d=[];_.each(e.allProducts,function(r){var c=r.cliente[0].cliente,l=u(r,i,o);if(void 0!=c){var f=a(c,t);(l||f)&&(c in d||(d[c]=s(c,r,e),d[c].openData=n.getData(d[c])),d[c].matchedProducts.push(r))}});for(client in d)d[client].matchedProducts=_.sortBy(d[client].matchedProducts,[function(e){return e.producto}]),f.push(d[client]);return l(f)},f}]);
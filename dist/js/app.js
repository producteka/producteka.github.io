var myApp=angular.module("myApp",[]);myApp.controller("appController",["$scope",function(e){function n(){var n=!1,o=!1,a=!1,u=function(){return!1!==n&&!1!==o&&!1!==a};!function(){$.ajax({url:"https://api.fieldbook.com/v1/57efcbd80cfca603001a8a2d/productos",headers:{Accept:"application/json"},success:function(o){e.$apply(function(){r=o,n=!0,e.loadComplete=u()})},error:function(e){console.log("error",e)}})}(),function(){$.ajax({url:"https://api.fieldbook.com/v1/57efcbd80cfca603001a8a2d/clientes",headers:{Accept:"application/json"},success:function(n){e.$apply(function(){t=n,o=!0,e.loadComplete=u()})},error:function(e){console.log("error",e)}})}(),function(){$.ajax({url:"https://api.fieldbook.com/v1/57efcbd80cfca603001a8a2d/horarios",headers:{Accept:"application/json"},success:function(n){e.$apply(function(){i=n,a=!0,e.loadComplete=u()})},error:function(e){console.log("error",e)}})}()}function o(e){var n,o=function(e,n,o,r){var t=function(){if(i===e){if(a>=n)return!0}else{if(i!==o)return!0;if(a<r)return!0}};if(null!=e&&null!=o){if(o===e)return!0;if(o<e){if((i>=e||i<=o)&&t())return!0}else if(i>=e&&i<=o&&t())return!0}return!1},r=!1,t=new Date,i=t.getHours(),a=t.getMinutes();for(var u in e.hours)if(function(){return 0===t.getDay()?"Domingo":1===t.getDay()?"Lunes":2===t.getDay()?"Martes":3===t.getDay()?"Miercoles":4===t.getDay()?"Jueves":5===t.getDay()?"Viernes":6===t.getDay()?"Sabado":void 0}()===e.hours[u].dia){if(void 0!=e.hours[u].abre&&void 0!=e.hours[u].cierra){var c=Number(e.hours[u].abre.split(":")[0]),s=Number(e.hours[u].abre.split(":")[1]),l=Number(e.hours[u].cierra.split(":")[0]),p=Number(e.hours[u].cierra.split(":")[1]);r=o(c,s,l,p)}void 0!=e.hours[u].vuelveabrir&&void 0!=e.hours[u].vuelvecerrar&&(c=Number(e.hours[u].vuelveabrir.split(":")[0]),s=Number(e.hours[u].vuelveabrir.split(":")[1]),l=Number(e.hours[u].vuelvecerrar.split(":")[0]),p=Number(e.hours[u].vuelvecerrar.split(":")[1]),r||(r=o(c,s,l,p))),n=function(e,n,o){if(void 0==n)return e;var r,t,i,a;return open1hour=Number(e.split(":")[0]),open2hour=Number(n.split(":")[0]),open1hour>open2hour?(i=open1hour,r=e,a=open2hour,t=n):(i=open2hour,r=n,a=open1hour,t=e),o<a?t:o<i?r:o>i?t:void 0}(e.hours[u].abre,e.hours[u].vuelveabrir,i),nextOpenHour=n?n.split(":")[0]:0}e.openData={isOpen:r,openTime:n,openHour:nextOpenHour}}e.isMobile=window.innerWidth<=600||window.innerHeight<=500,e.isSearchBoxFocused,e.loadComplete=!1,e.clientsShown,e.noResults,e.callPerformed=function(e){_trackEvent("Llamadas",e,searchKeyWords)},e.locationConsulted=function(e){_trackEvent("Ubicaciones",e,searchKeyWords)},e.search=function(n){var a=function(e){var n=e.toLowerCase(),n=_.deburr(n);return n},u=function(e){var n=e.split(" "),o=[["lomo","lomito"],["whiskey","whiski","wisky","whisky","wiskey","wiski"],["sandwich","sanguche","sanguich","baguette"],["cerveza","birra","cervesa"],["pizza","piza","pisa"],["muzzarella","muzarella","musarella","musarela"]],r="";return _.each(n,function(e){_.each(o,function(n){var o=!1;_.each(n,function(t){e===t&&(o=!0,_.each(n,function(e){r+=" "+e}))})})}),r},c=function(e){var n=function(e){return"s"===e.slice(-1)&&(e=e.slice(0,-1)),e};e=a(e);var o=e.split(" "),r=["de","la","que","el","en","y","a","los","del","las","con"],t=[];return _.each(o,function(e){_.indexOf(r,e)<0&&(e=n(e),t.push(e))}),t};document.getElementById("searchterm").blur(),e.noResults=!0,e.clientsShown=[];var s=c(n);e.clientsShown=function(e){var n=function(e,n){var o=0,r=a(e),t=c(r).length;return _.each(n,function(e){var n=new RegExp("\\b"+e,"i");-1!=r.search(n)&&o++}),o===t},s=function(e,n){var o=!0,r=a(e.producto);return void 0!=u(r)&&(r+=" "+u(r)),_.each(n,function(e){var n=new RegExp("\\b"+e,"i");-1==r.search(n)&&(o=!1)}),o},l=function(e,n,o,r){var t=_.find(r,["id",n.cliente[0].id]),i=[];return _.each(o,function(n){n.cliente[0]&&n.cliente[0].cliente===e&&i.push(n)}),{client:t,matchedProducts:[],hours:i}},p=[],h=[];_.each(r,function(r){var a=r.cliente[0].cliente,u=s(r,e);if(void 0!=a){var c=n(a,e);(u||c)&&(a in h||(h[a]=l(a,r,i,t),o(h[a])),h[a].matchedProducts.push(r))}});for(client in h)h[client].matchedProducts=_.sortBy(h[client].matchedProducts,[function(e){return e.producto}]),p.push(h[client]);return function(e){var n=_.groupBy(e,function(e){return!0===e.openData.isOpen?"open":void 0!=e.openData.openTime?"openLater":"closed"});return n.open=_.shuffle(n.open),n.openLater=_.sortBy(n.openLater,[function(e){return e.openData.openTime}]),n}(p)}(s),(void 0!=e.clientsShown.open&&e.clientsShown.open.length>0||void 0!=e.clientsShown.openLater&&e.clientsShown.openLater.length>0||void 0!=e.clientsShown.closed&&e.clientsShown.closed.length>0)&&(e.noResults=!1),e.noResults?ga("send","pageview","search?searchText="+n.toLowerCase()+" (Not Found)"):ga("send","pageview","search?searchText="+n.toLowerCase())},e.logoPressed=function(){document.getElementById("searchterm").focus()};var r,t,i;!function(){n()}()}]);